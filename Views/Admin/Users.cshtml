@model List<JobConnect.Models.User>

@{
    ViewData["Title"] = "Manage Users";
}

<div class="container py-5 admin-users-page">

    <h2 class="admin-users-title mb-4 text-center">User Management</h2>

    <div class="card shadow-sm p-4 admin-users-card">

        <table class="table table-bordered table-hover admin-users-table">
            <thead class="admin-users-thead">
                <tr>
                    <th>User ID</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>

            <tbody>
                @if (Model == null || !Model.Any())
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted py-3">
                            No users found.
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var user in Model)
                    {
                        <tr class="admin-users-row">
                            <td>@user.UserId</td>
                            <td>@user.Email</td>
                            <td>@user.Phone</td>
                            <td>@user.Role</td>

                            <td>
                                @if (user.IsActive)
                                {
                                    <span class="badge bg-success admin-users-status">Active</span>
                                }
                                else
                                {
                                    <span class="badge bg-danger admin-users-status">Inactive</span>
                                }
                            </td>

                            <td class="text-center">

                                <button class="btn btn-sm btn-outline-warning admin-users-btn-toggle"
                                        data-id="@user.UserId">
                                    @(user.IsActive ? "Disable" : "Enable")
                                </button>

                                <button class="btn btn-sm btn-outline-danger admin-users-btn-delete"
                                        data-id="@user.UserId">
                                    Delete
                                </button>

                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>

    </div>
</div>

@section Scripts {
    <script>

        document.addEventListener("DOMContentLoaded", () => {

            document.querySelectorAll(".admin-users-btn-delete").forEach(btn => {
                btn.addEventListener("click", async () => {

                    if (!confirm("Are you sure you want to delete this user?"))
                        return;

                    let id = btn.getAttribute("data-id");

                    const response = await fetch(`/Admin/DeleteUser?id=${id}`, {
                        method: "POST"
                    });

                    const result = await response.json();

                    if (result.success) {
                        btn.closest("tr").remove();
                    } else {
                        alert(result.message);
                    }
                });
            });
            document.querySelectorAll(".admin-users-btn-toggle").forEach(btn => {
                btn.addEventListener("click", async () => {

                    let id = btn.getAttribute("data-id");

                    const response = await fetch(`/Admin/ToggleUser?id=${id}`, {
                        method: "POST"
                    });

                    const result = await response.json();

                    if (result.success) {
                        location.reload();
                    } else {
                        alert(result.message);
                    }
                });
            });

        });

    </script>
}
